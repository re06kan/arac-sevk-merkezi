import{a as u}from"./chunk-YCMZOG5D.js";import{$ as c,T as n,W as a,l as i,z as l,zc as g}from"./chunk-DASZUGZO.js";var m=class o{constructor(e){this.http=e;this.checkAndRefreshAuth()}apiUrl=`${u.apiUrl}/auth`;tokenRefreshTimer=null;login(e,t){return this.http.post(`${this.apiUrl}/login`,{username:e,password:t}).pipe(n(r=>{localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("isLoggedIn","true")}),l(r=>(console.error("Login error:",r),i(()=>new Error("Giri\u015F ba\u015Far\u0131s\u0131z. L\xFCtfen kullan\u0131c\u0131 ad\u0131 ve \u015Fifrenizi kontrol edin.")))))}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")}isLoggedIn(){return localStorage.getItem("isLoggedIn")==="true"}getToken(){return localStorage.getItem("token")}getCurrentUser(){let e=localStorage.getItem("user");return e?JSON.parse(e):null}getUserRole(){let e=this.getCurrentUser();return e?e.role:null}checkAndRefreshAuth(){console.log("Auth durumu kontrol ediliyor");try{if(typeof localStorage>"u")return console.error("localStorage mevcut de\u011Fil"),!1;let e=localStorage.getItem("token"),t=localStorage.getItem("isLoggedIn")==="true",r=localStorage.getItem("user");return console.log("Token mevcut:",!!e),console.log("IsLoggedIn de\u011Feri:",t),console.log("User mevcut:",!!r),t}catch(e){return console.error("Auth durumu kontrol edilirken hata:",e),!1}}setupTokenRefresh(e){try{let r=JSON.parse(atob(e.split(".")[1])).exp*1e3,h=Date.now(),s=r-h-5*60*1e3;s>0?(clearTimeout(this.tokenRefreshTimer),this.tokenRefreshTimer=setTimeout(()=>{this.refreshToken()},s)):this.logout()}catch(t){console.error("Token kontrol\xFC s\u0131ras\u0131nda hata:",t)}}refreshToken(){return this.http.post(`${this.apiUrl}/refresh-token`,{token:this.getToken()}).pipe(n(e=>{e&&e.token&&(localStorage.setItem("token",e.token),this.setupTokenRefresh(e.token))}))}static \u0275fac=function(t){return new(t||o)(c(g))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
